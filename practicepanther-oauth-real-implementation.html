<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PracticePanther OAuth Integration - Real Implementation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #333;
        }

        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border-radius: 12px;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        h1 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 28px;
            text-align: center;
        }

        .subtitle {
            color: #718096;
            margin-bottom: 32px;
            font-size: 16px;
            text-align: center;
        }

        .warning {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }

        .warning h3 {
            margin-bottom: 12px;
            font-size: 18px;
        }

        .warning ul {
            margin-left: 20px;
        }

        .warning li {
            margin-bottom: 8px;
        }

        .info-section {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-section h3 {
            color: #2d3748;
            margin-bottom: 12px;
            font-size: 18px;
        }

        .info-section p, .info-section li {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .solution {
            background: #c6f6d5;
            color: #2f855a;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 16px;
            margin: 20px 0;
        }

        .solution h3 {
            margin-bottom: 12px;
            font-size: 18px;
        }

        .code-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            margin: 12px 0;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn.secondary:hover {
            background: #cbd5e0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .step {
            background: #edf2f7;
            border-left: 4px solid #667eea;
            padding: 16px;
            margin: 16px 0;
        }

        .step h4 {
            color: #2d3748;
            margin-bottom: 8px;
        }

        .architecture {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .architecture h3 {
            color: #234e52;
            margin-bottom: 12px;
        }

        .flow-diagram {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 16px 0;
            text-align: center;
        }

        .flow-step {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 4px;
            font-size: 14px;
        }

        .arrow {
            color: #667eea;
            font-size: 20px;
            margin: 0 10px;
        }

        ol {
            padding-left: 20px;
        }

        ol li {
            margin-bottom: 12px;
        }

        .highlight {
            background: #fef5e7;
            border: 1px solid #f6ad55;
            border-radius: 4px;
            padding: 12px;
            margin: 8px 0;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">PP</div>
        <h1>PracticePanther OAuth Integration</h1>
        <p class="subtitle">Real-world implementation guide with solutions to known issues</p>
        
        <div class="warning">
            <h3>‚ö†Ô∏è Critical Issues Discovered</h3>
            <p>Through investigation, I found several problems with PracticePanther's API implementation:</p>
            <ul>
                <li><strong>Cloudflare Anti-DDoS Protection:</strong> Server requests return HTML pages instead of JSON</li>
                <li><strong>CORS Policy Restrictions:</strong> API calls are blocked from domains other than PracticePanther's</li>
                <li><strong>HTTPS-Only Redirects:</strong> Local development requires HTTPS or tools like ngrok</li>
                <li><strong>Frontend Security Issues:</strong> Client secret must never be exposed in browser code</li>
            </ul>
        </div>

        <div class="architecture">
            <h3>üèóÔ∏è Proper Architecture Required</h3>
            <p>PracticePanther OAuth cannot be implemented purely in the frontend. You need:</p>
            
            <div class="flow-diagram">
                <div class="flow-step">Frontend</div>
                <span class="arrow">‚Üí</span>
                <div class="flow-step">Your Backend</div>
                <span class="arrow">‚Üí</span>
                <div class="flow-step">PracticePanther API</div>
            </div>
            
            <p>Your backend acts as a proxy to handle authentication and API calls, avoiding CORS and security issues.</p>
        </div>

        <div class="info-section">
            <h3>üìã OAuth Configuration</h3>
            <p><strong>Client ID:</strong> c1ba43b4-155b-4a69-90cb-55cf7f1e7f41</p>
            <p><strong>Redirect URI:</strong> https://localhost:8000 (must be HTTPS)</p>
            <p><strong>Authorization URL:</strong> https://app.practicepanther.com/oauth/authorize</p>
            <p><strong>Token URL:</strong> https://app.practicepanther.com/oauth/token</p>
        </div>

        <div class="solution">
            <h3>‚úÖ Solution: Backend Implementation</h3>
            <p>Here's how to properly implement PracticePanther OAuth:</p>
            
            <div class="step">
                <h4>Step 1: Set up HTTPS for Local Development</h4>
                <p>Install ngrok or create SSL certificates for localhost:</p>
                <div class="code-block"># Using ngrok
npm install -g ngrok
ngrok http 8000

# This gives you: https://abc123.ngrok.io
# Register this URL with PracticePanther as your redirect URI</div>
            </div>

            <div class="step">
                <h4>Step 2: Backend OAuth Handler (Node.js Example)</h4>
                <div class="code-block">const express = require('express');
const axios = require('axios');
const app = express();

const CONFIG = {
    clientId: 'c1ba43b4-155b-4a69-90cb-55cf7f1e7f41',
    clientSecret: '17023fb5-1372-4e67-a977-ff1383493075', // Server-side only!
    redirectUri: 'https://your-ngrok-url.ngrok.io/auth/callback',
    baseUrl: 'https://app.practicepanther.com'
};

// Route 1: Initiate OAuth
app.get('/auth/start', (req, res) => {
    const state = generateRandomState();
    req.session.oauthState = state; // Store in session
    
    const authUrl = `${CONFIG.baseUrl}/oauth/authorize?` +
        `response_type=code&` +
        `client_id=${CONFIG.clientId}&` +
        `redirect_uri=${encodeURIComponent(CONFIG.redirectUri)}&` +
        `state=${state}`;
    
    res.redirect(authUrl);
});

// Route 2: Handle OAuth callback
app.get('/auth/callback', async (req, res) => {
    const { code, state } = req.query;
    
    // Verify state parameter
    if (state !== req.session.oauthState) {
        return res.status(400).send('Invalid state parameter');
    }
    
    try {
        // Exchange code for token
        const tokenResponse = await axios.post(`${CONFIG.baseUrl}/oauth/token`, {
            grant_type: 'authorization_code',
            code: code,
            client_id: CONFIG.clientId,
            client_secret: CONFIG.clientSecret,
            redirect_uri: CONFIG.redirectUri
        }, {
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'User-Agent': 'YourApp/1.0' // Important for Cloudflare
            }
        });
        
        const { access_token, refresh_token } = tokenResponse.data;
        
        // Store tokens securely (database, encrypted session, etc.)
        req.session.accessToken = access_token;
        req.session.refreshToken = refresh_token;
        
        res.redirect('/dashboard'); // Redirect to your app
        
    } catch (error) {
        console.error('Token exchange failed:', error.response?.data || error.message);
        res.status(500).send('Authentication failed');
    }
});

// Route 3: Proxy API calls to avoid CORS
app.get('/api/practicepanther/*', async (req, res) => {
    const accessToken = req.session.accessToken;
    if (!accessToken) {
        return res.status(401).send('Not authenticated');
    }
    
    try {
        const apiPath = req.path.replace('/api/practicepanther', '');
        const response = await axios.get(`${CONFIG.baseUrl}/api/v2${apiPath}`, {
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Accept': 'application/json',
                'User-Agent': 'YourApp/1.0'
            }
        });
        
        res.json(response.data);
    } catch (error) {
        res.status(error.response?.status || 500).json({
            error: error.response?.data || error.message
        });
    }
});

function generateRandomState() {
    return Math.random().toString(36).substring(2, 15) + 
           Math.random().toString(36).substring(2, 15);
}</div>
            </div>

            <div class="step">
                <h4>Step 3: Frontend Implementation</h4>
                <div class="code-block">// Frontend just redirects to your backend
function startOAuth() {
    window.location.href = '/auth/start';
}

// Make API calls through your backend proxy
async function getContacts() {
    const response = await fetch('/api/practicepanther/contacts');
    if (response.ok) {
        return await response.json();
    }
    throw new Error('Failed to fetch contacts');
}</div>
            </div>
        </div>

        <div class="info-section">
            <h3>üîß Alternative Solutions</h3>
            <ol>
                <li><strong>CORS Proxy:</strong> Use a service like CORS Anywhere, but this is not recommended for production</li>
                <li><strong>Browser Extension:</strong> Disable CORS in development (unsafe for production)</li>
                <li><strong>Server-side Only:</strong> Build a pure backend integration without browser interaction</li>
            </ol>
        </div>

        <div class="highlight">
            <strong>Important:</strong> The token endpoint expects form-encoded data, not JSON. Make sure to set the correct Content-Type header.
        </div>

        <div class="info-section">
            <h3>üöÄ Next Steps</h3>
            <ol>
                <li>Set up ngrok or SSL certificates for local HTTPS</li>
                <li>Register your HTTPS redirect URI with PracticePanther</li>
                <li>Implement the backend OAuth handler using the code above</li>
                <li>Build your frontend to use the backend proxy</li>
                <li>Test the complete flow end-to-end</li>
            </ol>
        </div>

        <div class="step">
            <h4>üß™ Testing Your Implementation</h4>
            <p>Once your backend is running:</p>
            <div class="code-block"># Test the OAuth flow
curl -X GET "https://your-domain.com/auth/start"

# Test API calls (after authentication)
curl -X GET "https://your-domain.com/api/practicepanther/contacts" \
  -H "Cookie: session=your-session-cookie"</div>
        </div>

        <button onclick="window.open('https://ngrok.com/download', '_blank')" class="btn">
            üì• Download ngrok
        </button>
        
        <button onclick="showImplementationGuide()" class="btn secondary">
            üìñ Show Full Code Example
        </button>
    </div>

    <script>
        function showImplementationGuide() {
            alert('The complete implementation is shown in the code blocks above. Key points:\n\n' +
                  '1. Never put client_secret in frontend code\n' +
                  '2. Use your backend as a proxy for API calls\n' +
                  '3. Set up HTTPS for local development\n' +
                  '4. Include proper User-Agent headers for Cloudflare\n' +
                  '5. Use form-encoded data for token requests\n\n' +
                  'This architecture solves all the CORS and security issues with PracticePanther\'s API.');
        }
        
        // Show current URL for reference
        console.log('Current URL for testing:', window.location.href);
        console.log('Remember: You need HTTPS for PracticePanther OAuth to work properly');
    </script>
</body>
</html> 