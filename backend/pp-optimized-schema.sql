-- ================================================================\n-- PRACTICEPANTHER OPTIMIZED SCHEMA\n-- Generated: 2025-08-07T20:05:24.544Z\n-- Based on actual PP API data structure\n-- ================================================================\n\n-- USERS TABLE (9 PP fields)\nCREATE TABLE IF NOT EXISTS pp_users (\n    -- Core system fields\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    synced_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    -- PracticePanther fields (exact mapping)\n    pp_id VARCHAR(50),\n    pp_is_active BOOLEAN DEFAULT true,\n    pp_display_name VARCHAR(50),\n    pp_first_name VARCHAR(50),\n    pp_last_name VARCHAR(50),\n    pp_middle_name TEXT,\n    pp_email VARCHAR(50),\n    pp_created_at VARCHAR(50),\n    pp_updated_at VARCHAR(50),\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_pp_users_pp_id ON pp_users(pp_id);\n\n-- CONTACTS TABLE (14 PP fields)\nCREATE TABLE IF NOT EXISTS pp_contacts (\n    -- Core system fields\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    synced_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    -- PracticePanther fields (exact mapping)\n    pp_id VARCHAR(50),\n    pp_account_ref JSONB DEFAULT '{}',\n    pp_is_primary_contact BOOLEAN DEFAULT true,\n    pp_display_name VARCHAR(50),\n    pp_first_name VARCHAR(50),\n    pp_middle_name VARCHAR(50),\n    pp_last_name VARCHAR(50),\n    pp_phone_mobile VARCHAR(50),\n    pp_phone_home VARCHAR(50),\n    pp_phone_fax VARCHAR(50),\n    pp_phone_work VARCHAR(50),\n    pp_email VARCHAR(50),\n    pp_notes TEXT,\n    pp_custom_field_values JSONB DEFAULT '[]',\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_pp_contacts_pp_id ON pp_contacts(pp_id);\n\n-- MATTERS TABLE (16 PP fields)\nCREATE TABLE IF NOT EXISTS pp_matters (\n    -- Core system fields\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    synced_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    -- PracticePanther fields (exact mapping)\n    pp_id VARCHAR(50),\n    pp_account_ref JSONB DEFAULT '{}',\n    pp_number INTEGER,\n    pp_display_name TEXT,\n    pp_name VARCHAR(255),\n    pp_notes TEXT,\n    pp_rate VARCHAR(50),\n    pp_open_date VARCHAR(50),\n    pp_close_date VARCHAR(50),\n    pp_statute_of_limitation_date TEXT,\n    pp_tags JSONB DEFAULT '[]',\n    pp_status VARCHAR(50),\n    pp_assigned_to_users JSONB DEFAULT '[]',\n    pp_custom_field_values JSONB DEFAULT '[]',\n    pp_created_at VARCHAR(50),\n    pp_updated_at VARCHAR(50),\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_pp_matters_pp_id ON pp_matters(pp_id);\n\n-- TASKS TABLE (13 PP fields)\nCREATE TABLE IF NOT EXISTS pp_tasks (\n    -- Core system fields\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    synced_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    -- PracticePanther fields (exact mapping)\n    pp_id VARCHAR(50),\n    pp_account_ref JSONB DEFAULT '{}',\n    pp_matter_ref JSONB DEFAULT '{}',\n    pp_subject VARCHAR(50),\n    pp_notes VARCHAR(255),\n    pp_priority VARCHAR(50),\n    pp_status VARCHAR(50),\n    pp_due_date VARCHAR(50),\n    pp_assigned_to_users JSONB DEFAULT '[]',\n    pp_assigned_to_contacts JSONB DEFAULT '[]',\n    pp_tags JSONB DEFAULT '[]',\n    pp_created_at VARCHAR(50),\n    pp_updated_at VARCHAR(50),\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_pp_tasks_pp_id ON pp_tasks(pp_id);\n\n-- INVOICES TABLE (17 PP fields)\nCREATE TABLE IF NOT EXISTS pp_invoices (\n    -- Core system fields\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    synced_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    -- PracticePanther fields (exact mapping)\n    pp_account_ref JSONB DEFAULT '{}',\n    pp_matter_ref JSONB DEFAULT '{}',\n    pp_id VARCHAR(50),\n    pp_issue_date VARCHAR(50),\n    pp_due_date VARCHAR(50),\n    pp_items_time_entries JSONB DEFAULT '[]',\n    pp_items_expenses JSONB DEFAULT '[]',\n    pp_items_flat_fees JSONB DEFAULT '[]',\n    pp_subtotal INTEGER,\n    pp_tax INTEGER,\n    pp_discount INTEGER,\n    pp_total INTEGER,\n    pp_total_paid INTEGER,\n    pp_total_outstanding INTEGER,\n    pp_invoice_type VARCHAR(50),\n    pp_created_at VARCHAR(50),\n    pp_updated_at VARCHAR(50),\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_pp_invoices_pp_id ON pp_invoices(pp_id);\n\n-- EXPENSES TABLE (15 PP fields)\nCREATE TABLE IF NOT EXISTS pp_expenses (\n    -- Core system fields\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n    synced_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\n    -- PracticePanther fields (exact mapping)\n    pp_id VARCHAR(50),\n    pp_is_billable BOOLEAN DEFAULT true,\n    pp_is_billed BOOLEAN DEFAULT false,\n    pp_date VARCHAR(50),\n    pp_qty INTEGER,\n    pp_price INTEGER,\n    pp_amount INTEGER,\n    pp_description VARCHAR(50),\n    pp_private_notes TEXT,\n    pp_account_ref JSONB DEFAULT '{}',\n    pp_matter_ref JSONB DEFAULT '{}',\n    pp_billed_by_user_ref JSONB DEFAULT '{}',\n    pp_expense_category_ref JSONB DEFAULT '{}',\n    pp_created_at VARCHAR(50),\n    pp_updated_at VARCHAR(50),\n);\n\nCREATE UNIQUE INDEX IF NOT EXISTS idx_pp_expenses_pp_id ON pp_expenses(pp_id);\n\n-- ================================================================\n-- RELATIONSHIPS AND INDEXES\n-- ================================================================\n\n-- Add performance indexes\nCREATE INDEX IF NOT EXISTS idx_pp_contacts_account_ref ON pp_contacts(pp_account_ref_id);\nCREATE INDEX IF NOT EXISTS idx_pp_matters_account_ref ON pp_matters(pp_account_ref_id);\nCREATE INDEX IF NOT EXISTS idx_pp_tasks_matter_ref ON pp_tasks(pp_matter_ref_id);\nCREATE INDEX IF NOT EXISTS idx_pp_invoices_matter_ref ON pp_invoices(pp_matter_ref_id);\n\n-- Add sync timestamp indexes\nCREATE INDEX IF NOT EXISTS idx_pp_contacts_synced ON pp_contacts(synced_at);\nCREATE INDEX IF NOT EXISTS idx_pp_matters_synced ON pp_matters(synced_at);\nCREATE INDEX IF NOT EXISTS idx_pp_tasks_synced ON pp_tasks(synced_at);\n\n